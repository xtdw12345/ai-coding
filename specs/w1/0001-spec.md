项目：Project Alpha - Ticket 标签管理系统需求与设计文档
========================================

## 1. 背景与目标

本项目旨在实现一个简单易用的 Ticket 管理系统，用于记录和跟踪各类待办事项、问题或需求，并通过标签（Tag）对 Ticket 进行分类与筛选。系统面向单一用户使用场景（无需用户登录/注册等用户体系），重点在于：

- **快速记录与管理 Ticket**
- **通过标签进行灵活分类与筛选**
- **支持根据标题搜索 Ticket**

技术栈要求：

- **数据库**：MySQL
- **后端**：Java（采用经典三层架构：Controller / Service / DAO）
- **前端**：基于 JSP + 原生 JavaScript + CSS（可配合少量 jQuery，但非必须）
- **部署形态**：传统 Java Web 应用（如打包为 WAR 部署到 Tomcat）

## 2. 术语定义

- **Ticket**：一条待办或问题记录，包含标题、描述、状态、创建时间、更新时间等信息。
- **标签（Tag）**：用于对 Ticket 进行分类的关键字，一个 Ticket 可以有 0 个或多个标签。
- **完成 / 取消完成**：对 Ticket 的状态操作，表示该 Ticket 是否已经处理完毕。

## 3. 功能需求

### 3.1 Ticket 基本管理

#### 3.1.1 创建 Ticket

- **入口**：
  - 在“Ticket 列表页”上有“新建 Ticket”按钮，点击后进入“新建 Ticket 页面”或弹出对话框。
- **输入字段**：
  - 标题（title）：必填，长度 1–200 字符。
  - 描述（description）：可选，多行文本，长度上限可设为 2000 字符。
  - 标签（tags）：可选，可在创建时直接选择已有标签或输入新标签（以逗号分隔）。
- **业务规则**：
  - 标题为空时不允许保存，前端与后端都需校验。
  - 新标签在保存时需自动写入标签表，并建立 Ticket 与标签的关联关系。
  - 新建 Ticket 的初始状态为“未完成”。
- **结果**：
  - 保存成功后跳转回 Ticket 列表页，并在顶部提示“创建成功”。

#### 3.1.2 编辑 Ticket

- **入口**：
  - 在 Ticket 列表中，每条记录有“编辑”操作，点击后进入“编辑 Ticket 页面”，表单内容带出当前数据。
- **可编辑字段**：
  - 标题、描述。
  - 标签列表：可新增、删除标签关联。
- **业务规则**：
  - 修改标题同样需校验非空和长度。
  - 编辑时可添加新的标签（自动创建标签）并更新关联关系。
- **结果**：
  - 保存成功后返回列表页，显示“更新成功”提示。

#### 3.1.3 删除 Ticket

- **入口**：
  - 列表中的每条 Ticket 带有“删除”按钮。
- **交互**：
  - 点击后弹出确认对话框：“确认要删除该 Ticket 吗？此操作不可恢复。”
- **业务规则**：
  - 删除 Ticket 时，删除 Ticket 本身记录以及 Ticket 与标签的关联关系。
  - 不自动删除标签表中的标签记录（避免影响其他 Ticket）。
- **结果**：
  - 删除成功后列表自动刷新或局部刷新，提示“删除成功”。

#### 3.1.4 完成 / 取消完成 Ticket

- **入口**：
  - 在 Ticket 列表中，每条记录展示当前状态，并提供“标记完成”或“取消完成”操作。
- **业务规则**：
  - 完成状态字段采用布尔/枚举（如 `status = OPEN / DONE`）。
  - 标记完成时记录完成时间（可选）。
  - 取消完成时清空完成时间（可选）。
- **结果**：
  - 列表中该 Ticket 的状态显示更新，可通过样式（如绿色标记、划线）进行区分。

### 3.2 标签管理需求

由于系统无需单独的“标签管理”界面，标签的生命周期绑定在 Ticket 的创建/编辑流程中。

#### 3.2.1 为 Ticket 添加标签

- **方式**：
  - 在创建/编辑 Ticket 时，在“标签”输入框中：
    - 从下拉列表中选择已有标签；
    - 或手动输入新标签名称并确认（如回车或逗号）。
- **业务规则**：
  - 标签名称必填、长度 1–50 字符。
  - 标签名在系统内全局唯一（大小写可忽略或保留，需在设计中明确）。
  - 对于新标签，系统自动在标签表中插入记录。

#### 3.2.2 为 Ticket 删除标签

- **方式**：
  - 在编辑页面中，每个已选标签旁边提供“×”或“移除”按钮，点击后从当前表单中移除该标签。
- **业务规则**：
  - 删除标签与 Ticket 的关联关系，但不删除标签本身。

### 3.3 Ticket 列表与筛选

#### 3.3.1 Ticket 列表展示

- **列表字段**：
  - 标题（可点击进入编辑页或详情页）
  - 状态（未完成 / 已完成）
  - 标签列表（以小标签形式展示）
  - 创建时间
  - 更新时间
- **排序规则**：
  - 默认按创建时间倒序（最新在前）。
  - 可扩展为按更新时间倒序。
- **分页**：
  - 采用简单分页，每页显示固定数量（如 10 条）。
  - 前端展示上一页/下一页以及当前页码。

#### 3.3.2 按标签筛选 Ticket

- **入口**：
  - 列表页顶部或侧边栏展示所有标签列表（或常用标签）。
  - 点击某个标签后，列表仅显示包含该标签的 Ticket。
- **支持多选模式（可选）**：
  - 简单实现可以只支持单标签筛选；
  - 如需支持多标签筛选，则为“包含任一选中标签的 Ticket”或“必须同时包含所有选中标签”的模式，需要在设计中明确（建议先实现单标签筛选）。

#### 3.3.3 按标题搜索 Ticket

- **入口**：
  - 列表页顶部提供搜索输入框和“搜索”按钮。
- **业务规则**：
  - 按标题字段进行模糊查询（LIKE %keyword%）。
  - 关键字为空时，返回全部 Ticket（可认为是“重置搜索”）。
- **组合条件**：
  - 搜索和标签筛选可以组合使用：
    - 如：已选择某标签 + 输入关键字时，返回满足标签条件且标题匹配关键字的 Ticket。

### 3.4 非功能性需求

- **性能**：
  - 针对单用户小数据量场景，无需特别的性能优化，但查询应控制在可接受的响应时间内（如 <1s）。
- **易用性**：
  - 操作按钮命名清晰，错误提示明确，表单校验有前端即时提示。
- **可维护性**：
  - 后端采用清晰的分层结构，DAO 与业务逻辑分离。
  - 页面结构与样式分离，尽量避免在 JSP 中写过多业务逻辑。

## 4. 系统设计

### 4.1 总体架构

- **客户端（浏览器）**：
  - 通过 JSP 渲染页面，使用 HTML + CSS + JS 与后端交互。
- **Web 应用服务**：
  - 使用 Java Web 框架（可选：原生 Servlet/JSP 或基于 Spring MVC 等），实现 Controller / Service / DAO 分层：
    - Controller：接收 HTTP 请求、参数校验、调用 Service、选择 JSP 视图。
    - Service：封装业务逻辑，处理事务、校验、组合查询等。
    - DAO：通过 JDBC 或 ORM（如 MyBatis/JPA）访问 MySQL 数据库。
- **数据库**：
  - 使用 MySQL 存储 Ticket 与标签信息。

### 4.2 数据库设计

#### 4.2.1 表结构概览

- `ticket`：存储 Ticket 主体信息。
- `tag`：存储标签定义。
- `ticket_tag`：Ticket 与标签的多对多关联关系。

#### 4.2.2 表字段设计（建议）

1. **表：`ticket`**

- `id`：主键，自增 BIGINT
- `title`：VARCHAR(200)，非空
- `description`：TEXT，可空
- `status`：TINYINT 或 VARCHAR(20)，取值如 0=未完成，1=已完成
- `created_at`：DATETIME，非空，默认当前时间
- `updated_at`：DATETIME，非空，默认当前时间，在更新时刷新
- `completed_at`：DATETIME，可空，标记完成时间

索引设计：

- 主键索引：`PK_ticket(id)`
- 普通索引：`idx_ticket_title`（title，支持搜索）
- 可选索引：`idx_ticket_status`（status）

2. **表：`tag`**

- `id`：主键，自增 BIGINT
- `name`：VARCHAR(50)，非空，唯一
- `created_at`：DATETIME，非空

索引设计：

- 主键索引：`PK_tag(id)`
- 唯一索引：`uk_tag_name(name)`

3. **表：`ticket_tag`**

- `id`：主键，自增 BIGINT（也可不设置 id，使用联合主键）
- `ticket_id`：BIGINT，非空，外键指向 `ticket.id`
- `tag_id`：BIGINT，非空，外键指向 `tag.id`

约束与索引：

- 唯一约束：(`ticket_id`, `tag_id`) 保证同一 Ticket 与同一标签不会重复关联。
- 索引：分别为 `idx_ticket_tag_ticket_id`、`idx_ticket_tag_tag_id`，加快查询。

### 4.3 后端接口设计（基于传统 MVC）

说明：这里用伪 URL 形式描述，具体实现可根据使用的框架进行调整。

#### 4.3.1 Ticket 列表与查询

- **URL**：`GET /tickets`
- **请求参数**：
  - `page`：页码（可选，默认 1）
  - `size`：每页条数（可选，默认 10）
  - `tagId`：标签 ID（可选，用于按标签筛选）
  - `keyword`：搜索关键字（可选，按标题模糊匹配）
- **返回**：
  - 渲染 JSP 页面 `ticket-list.jsp`
  - 模型数据包括：
    - 当前页 Ticket 列表
    - 分页信息（总数、总页数、当前页）
    - 标签列表（用于筛选）
    - 当前筛选条件

#### 4.3.2 显示新建 Ticket 页面

- **URL**：`GET /tickets/new`
- **行为**：
  - 渲染 `ticket-form.jsp` 页面（用于创建）。

#### 4.3.3 创建 Ticket

- **URL**：`POST /tickets`
- **请求参数（表单）**：
  - `title`
  - `description`
  - `tags`（可为逗号分隔的标签名称字符串，或多个同名参数）
- **行为**：
  - 校验输入。
  - 处理标签（查询已有标签、创建新标签）。
  - 插入 Ticket 记录与关联关系。
  - 成功后重定向到 `/tickets`。

#### 4.3.4 显示编辑 Ticket 页面

- **URL**：`GET /tickets/{id}/edit`
- **行为**：
  - 查询 Ticket 及其标签，渲染 `ticket-form.jsp` 页面（编辑模式）。

#### 4.3.5 更新 Ticket

- **URL**：`POST /tickets/{id}/update`（或 `PUT /tickets/{id}`，取决于框架与表单支持）
- **请求参数**：
  - 同创建接口。
- **行为**：
  - 更新 Ticket 基本信息。
  - 重建 Ticket 的标签关联关系（先删除旧关联再插入新关联）。

#### 4.3.6 删除 Ticket

- **URL**：`POST /tickets/{id}/delete`
- **行为**：
  - 删除 `ticket_tag` 中关联记录。
  - 删除 `ticket` 记录。

#### 4.3.7 完成 / 取消完成 Ticket

- **URL**：
  - 完成：`POST /tickets/{id}/complete`
  - 取消完成：`POST /tickets/{id}/reopen`
- **行为**：
  - 更新 `status` 字段与 `completed_at` 字段。

### 4.4 Service 设计

建议定义以下核心 Service 接口（以 Java 接口为例的抽象设计，不涉及具体语法）：

- `TicketService`
  - `createTicket(...)`
  - `updateTicket(...)`
  - `deleteTicket(id)`
  - `completeTicket(id)`
  - `reopenTicket(id)`
  - `getTicketById(id)`
  - `listTickets(condition, pagination)`

- `TagService`
  - `findOrCreateTagsByNames(List<String> names)`
  - `listAllTags()`

Service 负责：

- 业务规则校验（如标题不能为空）。
- 事务控制（创建/更新 Ticket 与标签关联需在一个事务中完成）。
- 组合 DAO 调用（Ticket + Tag + TicketTag）。

### 4.5 DAO 设计

每张表对应一个 DAO：

- `TicketDao`：基础 CRUD、分页查询、按条件查询。
- `TagDao`：按名称查询、创建标签、列出全部标签。
- `TicketTagDao`：删除/插入关联记录、按 Ticket/Tag 查询关联。

DAO 通过 JDBC 或 MyBatis 等方式与 MySQL 交互，返回领域对象或数据模型。

### 4.6 前端页面与交互设计（JSP + JS + CSS）

#### 4.6.1 页面列表

- `ticket-list.jsp`：
  - 展示 Ticket 列表、分页、标签筛选、搜索框。
  - 提供“新建 Ticket”按钮。
  - 每行 Ticket 提供“编辑”“删除”“完成/取消完成”操作按钮。

- `ticket-form.jsp`：
  - 用于创建和编辑 Ticket：
    - 标题输入框（必填，前端校验）。
    - 描述多行文本框。
    - 标签输入组件：
      - 可选择已有标签（如下拉、checkbox 列表）。
      - 可输入新标签名称（如输入框+添加按钮）。

#### 4.6.2 前端交互细节

- **表单校验**：
  - 使用 JS 在提交前检查标题非空、长度限制。
  - 不通过时阻止提交，并显示错误信息。

- **删除确认**：
  - 使用 `confirm()` 或自定义对话框确认是否删除。

- **完成状态展示**：
  - 已完成 Ticket 的标题可采用灰色、删除线样式。
  - 在按钮文本上体现当前动作（“标记完成” / “取消完成”）。

### 4.7 安全性与健壮性

- 对提交参数进行服务端校验，防止绕过前端校验导致脏数据。
- 防止 SQL 注入，使用预编译语句或 ORM 参数绑定。
- 对用户输入做基本 XSS 过滤（如在 JSP 输出时使用转义）。

## 5. 约束与假设

- 系统假设仅有单用户或少量内部用户使用，不考虑高并发问题。
- 不实现用户登录/logout、权限控制等功能。
- 暂不考虑国际化（i18n），统一使用中文界面与中文数据提示。
- 不要求实现复杂的前端框架（如 React/Vue），主打简洁可靠。

## 6. 后续可扩展方向（非当前必做）

- 增加 Ticket 优先级、截止日期等字段。
- 增加标签管理页面（重命名、删除标签等）。
- 支持导出 Ticket（如导出为 CSV/Excel）。
- 支持批量操作（批量标记完成、批量删除）。
- 增加简单的统计报表（按标签统计数量、按完成情况统计等）。

本需求与设计文档将作为后续实现计划（`0002-implementation-plan.md`）与实际代码开发（`w1/project-alpha`）的基础。


